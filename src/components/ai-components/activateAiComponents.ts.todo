// !!!! TODO

export function activateAiComponents(root: HTMLElement) {
    for (const element of Array.from(root.querySelectorAll('*[data-aiai]'))) {
        if (!(element instanceof HTMLElement)) {
            continue;
        }
        /* not await */ activateElement(element);
    }

    async function activateElement(element: HTMLElement) {
        const type = element.getAttribute('data-ai-component');
        if (type === 'gallery') {
            return await activateGalleryElement(element);
        } else {
            throw new Error(`Unknown aiai type "${type}"`);
        }
    }

    async function activateGalleryElement(element: HTMLElement) {
        element.innerHTML = `
            <div class="ai-gallery">
                <div class="ai-gallery-items">
                    <div class="inner">
                        <div class="placeholder"></div>
                        <div class="placeholder"></div>
                        <div class="placeholder"></div>
                        <div class="placeholder"></div>
                        <div class="placeholder"></div>
                        <div class="placeholder"></div>
                    </div>
                </div>
                <a href="https://app.1-2i.com/?home=https://1-2i.com/" class="button">More</a>
            </div>
        `;

        const response = await fetch(`mocked-api/wallpapers-min-loved.json`);
        const { wallpapers } = await response.json();

        const pickedWallpapers = [];
        const pickedWallpapersIds = new Set();

        while (pickedWallpapersIds.size < 6 /* <- [ðŸ¥¼]*/) {
            const wallpaper = wallpapers[Math.floor(Math.random() * wallpapers.length)];
            if (pickedWallpapersIds.has(wallpaper.id)) {
                continue;
            }
            pickedWallpapersIds.add(wallpaper.id);
            pickedWallpapers.push(wallpaper);
        }

        const itemsHtml = pickedWallpapers.map(
            ({ id, primaryColor }) => `
                <a href="https://app.1-2i.com/showcase/${id}">
                    <iframe
                        src="https://app.1-2i.com/showcase/${id}?mode=preview"
                        allowtransparency="false"
                        scrolling="no"
                        frameborder="0"
                        style="background-color: ${primaryColor};"
                    ></iframe>
                </a>
                
            `,
        );

        const html = `
            <div class="aiai ai-gallery">
                <div class="ai-gallery-items">
                    <div class="inner">
                        ${itemsHtml.join('\n\n\n')}
                    </div>
                </div>
                <a href="https://app.1-2i.com/?home=https://1-2i.com/" class="button">More</a>
            </div>
        `;

        element.innerHTML = html;
    }
}

/**
 * TODO: !!!! Split into files
 * TODO: Use spaceTrim
 * TODO: Maybe use shadow dom not just CSS / data-aiai prefixing
 * TODO: Recursive activation of elements
 * TODO: !!! This should be really exported / provided from Aiai as a embed integration
 */
