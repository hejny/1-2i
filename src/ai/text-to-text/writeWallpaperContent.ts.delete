import spaceTrim from 'spacetrim';
import { description, string_markdown, string_name, string_url, title, uuid } from '../../utils/typeAliases';
import {
    ptpLibrary_writeWebsiteContent_EntryParams,
    ptpLibrary_writeWebsiteContent_ResultParams,
} from './prompt-templates/ptpLibrary';
import { ptpLibraryExecutor } from './prompt-templates/ptpLibraryExecutor';

export interface WriteWallpaperContentOptions {
    /**
     * Client ID to validate the request
     */
    readonly clientId: uuid /* <-[üå∫] */;

   
}

/**
 * Writes the rich content of the wallpaper page
 *
 * Note: This function is aviable only on the server
 *
 * @param wallpaperAssigment as a plain description what is on the wallpaper (created for expample from imageToText or midjourney prompt)
 * @returns Content of the wallpaper page
 */
export async function writeWallpaperContent(options: WriteWallpaperContentOptions): Promise<string_markdown> {
    const { clientId, title, assigment, addSections, links } = options;

    // TODO: !!! Switch here language versions

    const { contentBody } = await ptpLibraryExecutor.executePtp<
        ptpLibrary_writeWebsiteContent_EntryParams,
        ptpLibrary_writeWebsiteContent_ResultParams
    >('writeWebsiteContent', {
        title: title || '',
        assigment: assigment || '',
        // TODO: !!! addSections:addSections || '',
        // TODO: !!!  links:links || '',
        /* <- TODO: !!! Allow null in params */
    });

    const content = spaceTrim(
        // TODO: !!! Allow to bundle combinated vars directly in PTPs
        (block) => `
            # ${title}

            ${block(contentBody!)}
    `,
    );

    return content as string_markdown /* <- TODO: !!! Type strongly */;

    /*
    const { clientId, assigment, addSections, links } = options;
    let { title } = options;

    let contentStart: string_markdown = '';

    if (title !== null) {
        contentStart = spaceTrim(
            (block) => `
    
                # ${block(title!)}
                
    
            `,
        );
    } else {
        if (!assigment) {
            throw new Error('Either title or assigment must be provided');
        }
        const prompt = createTitlePromptTemplate(assigment);
        const chatThread = await ChatThread.ask(prompt, clientId);
        const { response } = chatThread;
        const { title, topic } = parseTitleAndTopic(removeQuotes(response));

        contentStart = spaceTrim(
            (block) => `
    
                # ${block(title)}
                ${block(!topic ? `` : `\n\n> ${topic}\n\n`)}
    
            `,
        );
    }

<<<<<<< HEAD:src/ai/text-to-text/writeWallpaperContent.ts.delete
  
=======
    // TODO: !! Use here addSections and links

>>>>>>> main:src/ai/text-to-text/writeWallpaperContent.ts
    const { response: contentMiddle, model: modelToCreateContent } = await completeWithGpt(
        spaceTrim(
            // TODO: [ü§°] This prompt should be also created in some template function
            // TODO: [ü§°] Pefect this prompt
            (block) => `

                Following is markdown content of a webpage:

                ${block(contentStart)}
        
            `,
        ),
        clientId,
    );

<<<<<<< HEAD:src/ai/text-to-text/writeWallpaperContent.ts.delete
    // TODO: !!! Use or makeWrite WRITE_WEBSITE_CONTENT_TEMPLATE


=======
    /*
     TODO: !! Better
    const chatThreadFont = await chatThread.ask(createFontPromptTemplate());
    const font = removeQuotes(chatThreadFont.response) as string_font_family;
    */
>>>>>>> main:src/ai/text-to-text/writeWallpaperContent.ts

    const font = randomItem(...FONTS);

    return spaceTrim(
        (block) => `
    
            <!--font:${font}-->

            ${block(contentStart)}
            ${block(contentMiddle)}
        
        `,
    );

    */
}

/**
 * TODO: !!!last Go through this file and remove it
 * TODO: !!! Allow to be controlled by frontend - DO not have writeWallpaperContent OR write-wallpaper-content.ts BUT universal run-ptp-frame
 * TODO: !!! Make this function only as wrapper above writeWebsiteContentEn and writeWebsiteContentCs
 * TODO: [üß†] Naming writeWallpaperContent vs writeWebsiteContent
 * TODO: !! Put step by step instructions how the content is generated in footer comment
 * TODO: [üë∏] Use in generate-wallpapers-content and DRY
 * TODO: [üëÆ‚Äç‚ôÄÔ∏è] In this repository is used both 'chatgpt' and 'openai' NPM packages - use just 'openai' in future and in scripts use the common utils
 * TODO: Make IWriteWallpaperContentOptions
 */
